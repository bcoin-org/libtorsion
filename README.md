# libtorsion

![cmake](https://github.com/bcoin-org/libtorsion/workflows/cmake/badge.svg)

Crypto library in C, primarily for EC. Still semi-experimental.

Used as the backend for [bcrypto].

## Design Approach

- Generic, without sacrificing speed or security.
- Use field element backends generated by [fiat-crypto] (which have proofs of
  correctness, formal verification, etc).
- Use a generic barrett reduction for scalar arithmetic (leverage GMP's [mpn_]
  functions for this).
- Keep constant-time multiplication algorithms as simple as possible.
- Constant time, stack-based, and so on.
- Expose a simple opaque API which accepts all arguments in wire format
  (this eases implementation for language bindings, wasm, and other ffis).
- Dependency-less (aside from an optimized fork of mini-gmp).

## Current Features

- Curve Support:
    - p192
    - p224
    - p256
    - p384
    - p521
    - secp256k1
    - curve25519
    - curve448
    - edwards25519
    - edwards448
    - curve1174

- Schemes:
    - ECDSA
    - [BIP-Schnorr][schnorr]
    - [BIP340][bip340]
    - ECDH
    - EdDSA
    - [Ristretto][ristretto]

## Example

``` c
#include <assert.h>
#include <stddef.h>
#include <torsion/ecc.h>
#include <torsion/hash.h>
#include <torsion/rand.h>

int main(void) {
  wei_curve_t *ec = wei_curve_create(WEI_CURVE_SECP256K1);
  const char str[] = "hello world";
  unsigned char priv[32];
  unsigned char entropy[32];
  unsigned char msg[32];
  unsigned char pub[33];
  unsigned char sig[64];
  sha256_t hash;

  /* Hash our message with sha256. */
  sha256_init(&hash);
  sha256_update(&hash, str, sizeof(str) - 1);
  sha256_final(&hash, msg);

  /* Grab some entropy from the OS. */
  assert(torsion_getentropy(entropy, 32));

  /* Generate a key pair using entropy. */
  ecdsa_privkey_generate(ec, priv, entropy);
  assert(ecdsa_pubkey_create(ec, pub, NULL, priv, 1));

  /* Sign in constant time. */
  assert(ecdsa_sign(ec, sig, NULL, msg, sizeof(msg), priv));

  /* Verify our signature. */
  assert(ecdsa_verify(ec, msg, sizeof(msg), sig, pub, sizeof(pub)));

  /* Cleanup. */
  wei_curve_destroy(ec);

  return 0;
}
```

Compile with:

``` bash
$ cc -o example example.c -ltorsion
```

## Contribution and License Agreement

If you contribute code to this project, you are implicitly allowing your code
to be distributed under the MIT license. You are also implicitly verifying that
all code is your original work. `</legalese>`

## License

- Copyright (c) 2020, Christopher Jeffrey (MIT License).

See LICENSE for more info.

[bcrypto]: https://github.com/bcoin-org/bcrypto
[fiat-crypto]: https://github.com/mit-plv/fiat-crypto
[mpn_]: https://gmplib.org/manual/Low_002dlevel-Functions.html
[schnorr]: https://github.com/sipa/bips/blob/d194620/bip-schnorr.mediawiki
[bip340]: https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki
[ristretto]: https://ristretto.group/
